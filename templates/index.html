<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOULS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        :root {
            --highlight-blue: #00aaff;
            --off-white: #e0e0e0;
            --light-grey: #a0a0a0; /* Slightly lighter grey for text on blurry background */
            --font-main: 'Poppins', sans-serif;
            --panel-background: rgba(16, 16, 16, 0.4); /* Very subtle dark overlay for blur */
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            color: var(--off-white);
            /* NEW: Custom background image */
            background: url('/static/bg.jpg') no-repeat center center fixed;
            background-size: cover; /* Ensures image covers entire background */
            min-height: 100vh;
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 40px;
            padding: 50px;
            padding-left: 250px;
            overflow: hidden;
            position: relative; /* Needed for the pseudo-element overlay */
        }

        /* NEW: Dark overlay on background for better contrast with blurred elements */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4); /* Adjust opacity for desired darkness */
            z-index: -1; /* Place behind content */
        }

        /* NEW: Blurry Panels */
        .now-playing, .song-list-section {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center content in Now Playing */
            justify-content: center; /* Center content in Now Playing */
            text-align: center; /* Center text in Now Playing */
            background-color: var(--panel-background); /* Semi-transparent base */
            border-radius: 20px;
            backdrop-filter: blur(25px) saturate(180%); /* Stronger, Apple-like blur */
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.6); /* More prominent shadow for depth */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Subtle white border for definition */
        }

        .app-header { display: flex; align-items: center; gap: 20px; margin-bottom: 2em; }
        .app-header .logo { height: 100px; width: 100px; }
        .app-header h1 { font-size: 2.5rem; color: var(--off-white); margin: 0; font-weight: 700; }

        .album-art-wrapper { position: relative; width: 300px; height: 300px; margin-bottom: 30px; }
        .album-art { width: 100%; height: 100%; border-radius: 15px; object-fit: cover; box-shadow: 0 0 30px rgba(0, 0, 0, 0.6); border: 4px solid var(--highlight-blue); transition: all 0.3s ease-in-out; }
        .album-art.playing { transform: scale(1.03); }

        .current-song-title { font-size: 2rem; font-weight: 600; color: var(--off-white); margin: 0 0 5px 0; }
        .current-artist { font-size: 1.1rem; color: var(--light-grey); margin-bottom: 20px; }

        /* Custom Player Styles (Adjusted for Blur Background) */
        .player-controls-wrapper { width: 100%; }
        .progress-bar-container { width: 100%; height: 5px; background-color: rgba(255, 255, 255, 0.3); border-radius: 5px; cursor: pointer; margin: 20px 0; }
        .progress-bar-fill { width: 0%; height: 100%; background-color: var(--highlight-blue); border-radius: 5px; transition: width 0.1s linear; }
        .time-display { display: flex; justify-content: space-between; font-size: 0.8em; color: var(--light-grey); }

        .main-controls { display: flex; align-items: center; justify-content: center; gap: 30px; margin-top: 15px; }
        .main-controls .control-btn { background: none; border: none; color: var(--off-white); font-size: 1.5rem; cursor: pointer; transition: all 0.2s; }
        .main-controls .control-btn:hover { color: var(--highlight-blue); transform: scale(1.1); }
        .main-controls .play-pause-btn { font-size: 2.5rem; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .main-controls .play-pause-btn:hover { background-color: rgba(0, 170, 255, 0.1); }

        .extra-controls { display: flex; align-items: center; justify-content: flex-end; gap: 15px; margin-top: 15px; }
        .volume-container { display: flex; align-items: center; gap: 10px; }
        .volume-container i { color: var(--light-grey); }
        .volume-slider { -webkit-appearance: none; appearance: none; width: 80px; height: 4px; background: rgba(255, 255, 255, 0.3); border-radius: 2px; outline: none; cursor: pointer; }
        .volume-slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 14px; height: 14px; background: var(--highlight-blue); border-radius: 50%; cursor: pointer; }
        #audio-player { display: none; }

        /* Song List Section Styles (Adjusted for Blur Background) */
        .song-list-section { 
        text-align: left; 
        /* Keep song list left aligned */
        width: 700px; /* Increased width for longer song list display */
        max-width: 95vw; /* Responsive max width */ }
        .song-list-section h2 { margin: 0 0 25px 0; color: var(--off-white); font-size: 2rem; font-weight: 700; }
        #song-list { list-style: none; padding: 0; overflow-y: auto; flex-grow: 1; padding-right: 15px; }
        #song-list::-webkit-scrollbar { width: 10px; }
        #song-list::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        #song-list::-webkit-scrollbar-thumb { background: var(--highlight-blue); border-radius: 10px; }
        #song-list li {
            padding: 18px 25px;
            border-radius: 10px;
            margin-bottom: 12px;
            cursor: pointer;
            font-weight: 500;
            border-left: 5px solid transparent;
            transition: all 0.25s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: rgba(255, 255, 255, 0.05); /* Very subtle base for list items */
            padding: 18px 40px; /* More horizontal padding for longer titles */
            font-size: 1.15rem;
        }
        #song-list li:hover { background-color: rgba(255, 255, 255, 0.1); border-left: 5px solid var(--highlight-blue); transform: translateX(8px); }
        #song-list li.playing { background-color: rgba(255, 255, 255, 0.1);  border-left: 5px solid var(--highlight-blue); transform: translateX(8px); }
        #song-list li .play-icon { color: var(--light-grey); opacity: 0.8; transition: all 0.2s; }
        #song-list li:hover .play-icon, #song-list li.playing .play-icon { color: var(--highlight-blue); opacity: 1; }

        @media (max-width: 992px) {
            body { grid-template-columns: 1fr; padding: 20px; overflow-y: auto; }
            .now-playing, .song-list-section { padding: 30px; }
            .album-art-wrapper { width: 200px; height: 200px; }
            .song-list-section { width: 100%; max-width: 100vw; }
            #song-list li { padding: 18px 20px; font-size: 1rem; }
        }
    </style>
</head>
<body>
    
    <div class="now-playing">
        <div class="app-header">
            <img src="/static/logo.png" alt="Logo" class="logo">
            
        </div>
        <div class="album-art-wrapper">
            <img id="album-art" src="" alt="Album Art" class="album-art">
        </div>
        <h2 id="current-song-title" class="current-song-title">Select a Song</h2>
        <p id="current-artist" class="current-artist">from the list</p>
        
        <div class="player-controls-wrapper">
            <div class="progress-bar-container" id="progress-bar-container">
                <div class="progress-bar-fill" id="progress-bar-fill"></div>
            </div>
            <div class="time-display">
                <span id="current-time">0:00</span>
                <span id="total-duration">0:00</span>
            </div>
            <div class="main-controls">
                <button class="control-btn" id="prev-btn"><i class="fas fa-backward-step"></i></button>
                <button class="control-btn play-pause-btn" id="play-pause-btn"><i class="fas fa-play" id="play-pause-icon"></i></button>
                <button class="control-btn" id="next-btn"><i class="fas fa-forward-step"></i></button>
            </div>
            <div class="extra-controls">
                <div class="volume-container">
                    <i class="fas fa-volume-down"></i>
                    <input type="range" class="volume-slider" id="volume-slider" min="0" max="1" step="0.01" value="1">
                    <i class="fas fa-volume-up"></i>
                </div>
            </div>
        </div>
        
        <audio id="audio-player"></audio>
    </div>

    <div class="song-list-section">
        <h2>LIBRARY</h2>
        <ul id="song-list"></ul>
    </div>

    <script>
        const songListElement = document.getElementById('song-list');
        const audioPlayer = document.getElementById('audio-player');
        const albumArtElement = document.getElementById('album-art');
        const currentSongTitleElement = document.getElementById('current-song-title');
        const currentArtistElement = document.getElementById('current-artist');
        
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playPauseIcon = document.getElementById('play-pause-icon');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const currentTimeEl = document.getElementById('current-time');
        const totalDurationEl = document.getElementById('total-duration');
        const volumeSlider = document.getElementById('volume-slider');

        let currentlyPlayingListItem = null;
        let songsData = [];
        let currentSongIndex = 0;

        function parseSongTitle(fullTitle) {
            const parts = fullTitle.split(' - ');
            return parts.length > 1 ? { title: parts[0].trim(), artist: parts.slice(1).join(' - ').trim() } : { title: fullTitle.trim(), artist: "Unknown Artist" };
        }

        function loadSong(songIndex) {
            const song = songsData[songIndex];
            audioPlayer.src = song.mp3_path;
            albumArtElement.src = song.cover_path;
            currentSongTitleElement.textContent = song.title;
            currentArtistElement.textContent = song.artist;
            
            if (currentlyPlayingListItem) currentlyPlayingListItem.classList.remove('playing');
            const newActiveLi = songListElement.querySelector(`li[data-mp3-src="${song.mp3_path}"]`);
            if (newActiveLi) {
                newActiveLi.classList.add('playing');
                currentlyPlayingListItem = newActiveLi;
            }
        }
        
        function playSong() {
            audioPlayer.play();
            playPauseIcon.classList.replace('fa-play', 'fa-pause');
            albumArtElement.classList.add('playing');
        }

        function pauseSong() {
            audioPlayer.pause();
            playPauseIcon.classList.replace('fa-pause', 'fa-play');
            albumArtElement.classList.remove('playing');
        }
        
        function playNextSong() {
            currentSongIndex = (currentSongIndex + 1) % songsData.length;
            loadSong(currentSongIndex);
            playSong();
        }

        function playPrevSong() {
            currentSongIndex = (currentSongIndex - 1 + songsData.length) % songsData.length;
            loadSong(currentSongIndex);
            playSong();
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }

        function updateProgress() {
            const { duration, currentTime } = audioPlayer;
            if (duration) {
                const progressPercent = (currentTime / duration) * 100;
                progressBarFill.style.width = `${progressPercent}%`;
                totalDurationEl.textContent = formatTime(duration);
                currentTimeEl.textContent = formatTime(currentTime);
            }
        }
        
        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            if (duration) {
                audioPlayer.currentTime = (clickX / width) * duration;
            }
        }

        fetch('/api/songs')
            .then(response => response.json())
            .then(data => {
                if (data.length === 0) {
                    currentSongTitleElement.textContent = "No Songs Found";
                    currentArtistElement.textContent = "Add songs to the 'static' folder";
                    return;
                }
                
                songsData = data.map(song => ({ ...song, ...parseSongTitle(song.display_name) }));

                songsData.forEach(song => {
                    const li = document.createElement('li');
                    li.innerHTML = `<div><strong>${song.title}</strong><br><small style="color:var(--light-grey);">${song.artist}</small></div><i class="fas fa-play play-icon"></i>`;
                    li.setAttribute('data-mp3-src', song.mp3_path);
                    songListElement.appendChild(li);
                });

                currentSongIndex = 0;
                loadSong(currentSongIndex);
            });

        playPauseBtn.addEventListener('click', () => (audioPlayer.paused ? playSong() : pauseSong()));
        nextBtn.addEventListener('click', playNextSong);
        prevBtn.addEventListener('click', playPrevSong);
        
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', playNextSong);
        
        progressBarContainer.addEventListener('click', setProgress);
        
        volumeSlider.addEventListener('input', (e) => audioPlayer.volume = e.target.value);
        
        songListElement.addEventListener('click', e => {
            const targetLi = e.target.closest('li');
            if (targetLi) {
                const clickedSongSrc = targetLi.getAttribute('data-mp3-src');
                currentSongIndex = songsData.findIndex(song => song.mp3_path === clickedSongSrc);
                loadSong(currentSongIndex);
                playSong();
            }
        });

    </script>
</body>
</html>